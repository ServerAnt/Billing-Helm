{{ if .Values.postgresql_operator.enabled }}
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: {{ template "waldur.postgresql.host" . }}
spec:
  teamId: {{ template "waldur.postgresql.team" . }}
  postgresql:
    version: {{ .Values.postgresql_operator.version | quote }}
  numberOfInstances: {{ .Values.postgresql_operator.replicaCount }}
  volume:
    size: {{ .Values.postgresql_operator.size }}
    {{ if .Values.postgresql_operator.storageClass }}
    storageClass: {{ .Values.postgresql_operator.storageClass | quote }}
    {{ end }}
  users:
    {{ template "waldur.postgresql.user" . }}:
      - superuser
      - createdb
  databases:
    {{ template "waldur.postgresql.dbname" . }}: {{ template "waldur.postgresql.user" . }}
  enableMasterLoadBalancer: {{ .Values.postgresql_operator.loadBalancing.enableMaster }}
  enableReplicaLoadBalancer: {{ .Values.postgresql_operator.loadBalancing.enableReplica }}
  enableLogicalBackup: {{ .Values.postgresql_operator.enableLogicalBackup }}
{{ end }}
